<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Email Preferences</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <main class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h1 class="h4 mb-3">Email Preferences</h1>
                        <!-- form now posts to w3schools action page for testing and opens in a new tab -->
                        <form id="prefsForm" autocomplete="off" action="https://www.w3schools.com/action_page.php" method="get" target="_blank">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="prefCritical" name="critical">
                                <label class="form-check-label" for="prefCritical">
                                    Critical alerts and notifications about your tax return
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="prefOffers" name="offers">
                                <label class="form-check-label" for="prefOffers">
                                    Information about special offers for tax services
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="prefIRS" name="irs">
                                <label class="form-check-label" for="prefIRS">
                                    Receive notifications of IRS changes and deadlines
                                </label>
                            </div>

                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="prefNewsletter" name="newsletter">
                                <label class="form-check-label" for="prefNewsletter">
                                    Learn from monthly tax newsletter with tax news and tips
                                </label>
                            </div>

                            <div class="d-flex gap-2">
                                <!-- improved Save button with icon; it's the form submit button -->
                                <button type="submit" class="btn btn-primary d-flex align-items-center" id="saveBtn">
                                    <!-- simple inline check icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check2 me-2" viewBox="0 0 16 16" aria-hidden="true">
                                        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7.5 7.5a.5.5 0 0 1-.708 0L2.146 8.354a.5.5 0 1 1 .708-.708L6 10.793l7.146-7.147a.5.5 0 0 1 .708 0z"/>
                                    </svg>
                                    Save Preferences
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="resetBtn">Reset</button>
                                <div id="status" class="align-self-center text-success small ms-2" style="display:none;">Saved</div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const STORAGE_KEY = 'emailPreferences_v1';
        const form = document.getElementById('prefsForm');
        const status = document.getElementById('status');
        const resetBtn = document.getElementById('resetBtn');

        function loadPreferences() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (!stored) return;
            try {
                const prefs = JSON.parse(stored);
                Object.keys(prefs).forEach(k => {
                    const el = form.elements[k];
                    if (el) el.checked = !!prefs[k];
                });
            } catch (e) { console.warn('Invalid prefs', e); }
        }

        function savePreferences() {
            const data = {
                critical: form.elements['critical'].checked,
                offers: form.elements['offers'].checked,
                irs: form.elements['irs'].checked,
                newsletter: form.elements['newsletter'].checked
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            status.style.display = 'inline';
            setTimeout(()=> status.style.display = 'none', 1500);
        }

        form.addEventListener('submit', (e) => {
            // Save locally then allow the form to submit to the action URL (opens in new tab)
            savePreferences();
            // Do not call e.preventDefault() so the form will POST/GET to the action URL.
        });

        resetBtn.addEventListener('click', () => {
            // uncheck all and remove stored prefs
            ['critical','offers','irs','newsletter'].forEach(n => form.elements[n].checked = false);
            localStorage.removeItem(STORAGE_KEY);
            status.textContent = 'Reset';
            status.style.display = 'inline';
            setTimeout(()=>{
                status.style.display = 'none';
                status.textContent = 'Saved';
            }, 1200);
        });

        // initialize
        loadPreferences();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>